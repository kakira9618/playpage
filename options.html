<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title data-i18n="options.title">PlayPage - Options</title>
    <style>
      body { font-family: system-ui, sans-serif; padding: 16px; max-width: 900px; }
      label { display:block; margin-top: 12px; font-weight: 600; }
      input, textarea, select { width: 100%; padding: 8px; font-size: 14px; box-sizing: border-box; }
      textarea { font-family: monospace; resize: vertical; }
      select { width: auto; min-width: 150px; }
      .row { display:flex; gap: 12px; align-items: center; margin-top: 12px; flex-wrap: wrap; }
      button { padding: 8px 12px; font-size: 14px; cursor: pointer; }
      .hint { color:#555; font-size: 12px; margin-top: 4px; }
      .ok { color: #0a7; }
      .ng { color: #c00; }
      code { background:#f4f4f4; padding:2px 4px; }
      .prompt-section { margin-top: 20px; padding: 16px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; }
      .prompt-section h3 { margin: 0 0 12px 0; font-size: 16px; }
      .reset-btn { margin-left: 8px; padding: 2px 8px; font-size: 12px; }
      .lang-section { margin-bottom: 20px; padding: 16px; border: 1px solid #007bff; border-radius: 8px; background: #f0f7ff; }
      .site-prompt-item { margin-bottom: 16px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; background: #fff; }
      .site-prompt-item .site-url-row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
      .site-prompt-item .site-url-input { flex: 1; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; }
      .site-prompt-item .remove-site-btn { padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
      .site-prompt-item .remove-site-btn:hover { background: #c82333; }
      .site-prompt-item textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; resize: vertical; box-sizing: border-box; }
    </style>
  </head>
  <body>
    <h1>PlayPage - Options</h1>

    <div class="lang-section">
      <label data-i18n="options.language">言語 / Language</label>
      <select id="language">
        <option value="ja">日本語</option>
        <option value="en">English</option>
      </select>
      <div class="hint" data-i18n="options.languageHint">拡張機能のUIとプロンプトの言語を選択します。</div>
    </div>

    <h2 style="font-size: 18px; margin-bottom: 12px;" data-i18n="options.basicSettings">基本設定</h2>

    <label data-i18n="options.provider">プロバイダー</label>
    <div style="margin-top: 8px;">
      <label style="display: inline-flex; align-items: center; margin-right: 16px; font-weight: normal;">
        <input type="radio" name="provider" value="gemini-api" id="providerGeminiApi" style="width: auto; margin-right: 6px;">
        <span data-i18n="options.providerGeminiApi">Gemini API</span>
      </label>
      <label style="display: inline-flex; align-items: center; margin-right: 16px; font-weight: normal;">
        <input type="radio" name="provider" value="vertex-express" id="providerVertexExpress" style="width: auto; margin-right: 6px;">
        <span data-i18n="options.providerVertexExpress">Vertex AI Express Mode</span>
      </label>
      <label style="display: inline-flex; align-items: center; font-weight: normal;">
        <input type="radio" name="provider" value="vertex-standard" id="providerVertexStandard" style="width: auto; margin-right: 6px;">
        <span data-i18n="options.providerVertexStandard">Vertex AI Standard (OAuth)</span>
      </label>
    </div>
    <div class="hint" data-i18n-html="options.providerHint">
      プロバイダーの選択: Gemini APIは従来の方式、Vertex AI Express Modeは90日間無料トライアル付き、Vertex AI StandardはOAuth認証の本格版です。
    </div>

    <div id="geminiApiSettings" style="display: none;">
      <label data-i18n="options.apiKey">Gemini API Key</label>
      <input id="apiKey" type="password" placeholder="AIza..." />
      <div class="hint">
        <span data-i18n-html="options.apiKeyHint">APIキーは本拡張機能の <code>chrome.storage.local</code> に保存されます。</span><br>
        <span data-i18n="options.apiKeyHintLink">APIキーの発行方法</span>: <a href="https://ai.google.dev/gemini-api/docs/api-key?hl=ja" target="_blank" rel="noopener" id="apiKeyHelpLink">https://ai.google.dev/gemini-api/docs/api-key?hl=ja</a>
      </div>

      <label data-i18n="options.model">Gemini Model</label>
      <input id="model" type="text" value="gemini-3-pro-preview" />
      <div class="hint" data-i18n-html="options.modelHint">
        例: <code>gemini-3-pro-preview</code> <code>gemini-3-flash-preview</code>など。推奨：<code>gemini-3-pro-preview</code>
      </div>
    </div>

    <div id="vertexExpressSettings" style="display: none;">
      <label data-i18n="options.vertexApiKey">Google Cloud API Key</label>
      <input id="vertexApiKey" type="password" placeholder="AIza..." />
      <div class="hint">
        <span data-i18n-html="options.vertexApiKeyHint">Google Cloud APIキーは本拡張機能の <code>chrome.storage.local</code> に保存されます。</span><br>
        <span data-i18n="options.vertexApiKeyHintLink">APIキーの発行方法</span>: <a href="https://docs.cloud.google.com/vertex-ai/generative-ai/docs/start/api-keys" target="_blank" rel="noopener" id="vertexApiKeyHelpLink">Google Cloud API Key ドキュメント</a>
      </div>

      <label data-i18n="options.vertexModel">Vertex AI Model</label>
      <input id="vertexModel" type="text" value="gemini-3-pro-preview" />
      <div class="hint" data-i18n-html="options.vertexModelHint">
        例: <code>gemini-3-pro-preview</code> <code>gemini-3-flash-preview</code>など。推奨：<code>gemini-3-pro-preview</code>
      </div>
    </div>

    <div id="vertexStandardSettings" style="display: none;">
      <label data-i18n="options.vertexProjectId">Google Cloud Project ID</label>
      <input id="vertexProjectId" type="text" placeholder="my-project-123" />
      <div class="hint" data-i18n-html="options.vertexProjectIdHint">
        Google Cloud ProjectのIDを入力してください。<a href="https://console.cloud.google.com/" target="_blank" rel="noopener">Google Cloud Console</a>で確認できます。
      </div>

      <label data-i18n="options.vertexLocation">Location (Region)</label>
      <input id="vertexLocation" type="text" value="us-central1" />
      <div class="hint" data-i18n-html="options.vertexLocationHint">
        例: <code>us-central1</code>, <code>asia-northeast1</code>, <code>europe-west1</code>など。
      </div>

      <label data-i18n="options.vertexOAuthClientId">OAuth 2.0 Client ID</label>
      <input id="vertexOAuthClientId" type="text" placeholder="123456789.apps.googleusercontent.com" />
      <div class="hint" data-i18n-html="options.vertexOAuthClientIdHint">
        Google Cloud ConsoleでOAuth 2.0 Client IDを作成してください。アプリケーションタイプは「Chrome拡張機能」を選択します。<br>
        <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener">認証情報ページ</a>
      </div>
      <div style="margin-top: 12px; padding: 10px; background: #fffbea; border: 1px solid #f0ad4e; border-radius: 4px;">
        <strong data-i18n="options.redirectUriLabel">承認済みのリダイレクトURI:</strong><br>
        <code id="redirectUriDisplay" style="display: inline-block; margin-top: 4px; padding: 4px 8px; background: #fff; border: 1px solid #ddd; border-radius: 3px; font-size: 12px; word-break: break-all;"></code>
        <button id="copyRedirectUri" style="margin-left: 8px; padding: 4px 12px; font-size: 12px; cursor: pointer;" data-i18n="options.copyToClipboard">コピー</button>
      </div>

      <label data-i18n="options.vertexStandardModel">Vertex AI Model</label>
      <input id="vertexStandardModel" type="text" value="gemini-2.5-pro" />
      <div class="hint" data-i18n-html="options.vertexStandardModelHint">
        例: <code>gemini-2.5-pro</code> <code>gemini-2.5-flash</code>など。推奨：<code>gemini-2.5-pro</code>
      </div>

      <div style="margin-top: 16px; padding: 12px; background: #f0f7ff; border: 1px solid #007bff; border-radius: 6px;">
        <div style="margin-bottom: 8px;">
          <strong data-i18n="options.authStatus">認証状態:</strong>
          <span id="authStatus" data-i18n="options.authStatusNotAuthenticated">未認証</span>
        </div>
        <button id="authenticateButton" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;" data-i18n="options.authenticate">
          Googleアカウントで認証
        </button>
        <button id="revokeAuthButton" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px; display: none;" data-i18n="options.revokeAuth">
          認証を解除
        </button>
      </div>
    </div>

    <div class="row">
      <button id="save" data-i18n="options.save">保存</button>
      <button id="test" data-i18n="options.test">接続テスト</button>
      <span id="status"></span>
    </div>

    <div class="prompt-section" style="margin-top: 20px;">
      <h3 data-i18n="options.privacyTitle">プライバシーとデータ送信</h3>
      <div class="hint" data-i18n="options.privacyHint">
        生成時に閲覧ページのHTMLをGemini/Vertex AIへ送信します。最初の一度だけ同意を求め、ここで状態を確認・リセットできます。
      </div>
      <div class="row" style="align-items:center;">
        <label data-i18n="options.privacyStatusLabel" style="margin:0;">データ送信の同意</label>
        <span id="privacyStatus" style="font-weight:600;"></span>
      </div>
      <div class="row" style="margin-top:8px;">
        <button id="privacyShowPolicy" data-i18n="options.privacyShowPolicy">プライバシーポリシーを表示</button>
        <button id="privacyResetConsent" data-i18n="options.privacyReset">同意をリセット</button>
      </div>
    </div>

    <hr style="margin: 24px 0;">

    <h2 style="font-size: 18px; margin-bottom: 12px;" data-i18n="options.promptSettings">プロンプト設定</h2>

    <div class="prompt-section">
      <h3 data-i18n="options.promptGeneric">一般サイト用プロンプト</h3>
      <div class="hint" style="margin-bottom: 8px;" data-i18n="options.promptGenericHint">
        特定のサイト用プロンプトにマッチしないサイトで使用されるデフォルトのプロンプトです。
      </div>
      <textarea id="promptBaseGeneric" rows="10" placeholder="一般サイト用アプリ生成の基本指示..."></textarea>
      <button id="resetPromptGeneric" class="reset-btn" data-i18n="options.resetDefault">デフォルトに戻す</button>
    </div>

    <div class="prompt-section">
      <h3 data-i18n="options.promptSiteSpecific">特定のサイト用プロンプト</h3>
      <div class="hint" style="margin-bottom: 8px;" data-i18n="options.promptSiteSpecificHint">
        URLがマッチするサイトでは、一般サイト用ではなくこちらのプロンプトが使用されます。
      </div>
      <div id="sitePromptsContainer"></div>
      <button id="addSitePrompt" style="margin-top: 12px; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;" data-i18n="options.addSitePrompt">+ サイトを追加</button>
    </div>

    <div class="row" style="margin-top: 16px;">
      <button id="savePrompts" data-i18n="options.save">保存</button>
      <span id="promptStatus"></span>
    </div>

    <hr style="margin: 24px 0;">

    <h2 style="font-size: 18px; margin-bottom: 12px;" data-i18n="options.dataManagement">データのインポート・エクスポート</h2>

    <div style="margin-bottom: 20px;">
      <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;" data-i18n="options.allData">全データ（設定 + 履歴）</h3>
      <div class="hint" style="margin-bottom: 12px;" data-i18n="options.allDataHint">
        設定とVisualizer履歴データをバックアップ・復元できます。
      </div>
      <div class="row">
        <button id="exportData" data-i18n="options.exportAll">全データをエクスポート</button>
        <button id="importData" data-i18n="options.importAll">全データをインポート</button>
        <input type="file" id="importFile" accept=".json" style="display: none;">
      </div>
    </div>

    <div style="margin-bottom: 20px;">
      <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;" data-i18n="options.historyOnly">履歴データのみ</h3>
      <div class="hint" style="margin-bottom: 12px;" data-i18n="options.historyOnlyHint">
        Visualizerの履歴データのみを全て削除します。API Key、使用モデル、プロンプト設定は保持されます。
      </div>
      <div class="row">
        <button id="exportAndClearHistory" style="background-color: #d9534f; color: white; border-color: #d43f3a;" data-i18n="options.exportClearHistory">
          履歴をエクスポート＆全削除
        </button>
      </div>
    </div>

    <div class="row">
      <span id="importStatus"></span>
    </div>

    <script src="i18n.js"></script>
    <script src="options.js"></script>
  </body>
</html>
