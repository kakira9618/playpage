# PlayPage

AI（Gemini）を使用して、閲覧中のWebページの内容を解析し、理解を助ける**インタラクティブなアプリを即座に生成・埋め込み**できるChrome拡張機能です。

**あらゆるWebサイト**で利用可能で、サイトごとにカスタマイズされたプロンプトを設定することで、より適切なアプリ化を実現できます。

---

## 🚀 特徴

### 1. 形式に囚われない「自由なアプリ化」
既存のツールのように「マインドマップ」や「グラフ」といった特定の型に限定されません。AIがその場のコンテキストに合わせて**最適なアルゴリズムとインタラクティブなUIコード全体**をゼロから生成し、ページ内に埋め込みます。

### 2. 「見る」から「実験する」へ
単なる図解ではなく、動作するアプリケーションとして生成されます。パラメータを変更して結果をシミュレーションするなど、その場ですぐに試行錯誤が可能です。

### 3. ブラウザ統合によるスムーズなUX
チャットツールへコピペする必要はありません。ワンボタンで実行でき、履歴管理やプロンプトのカスタマイズ、バージョン切り替えまで、すべて拡張機能内で完結します。

---

## 🛠 機能一覧

- **即時生成・埋め込み**: Gemini 3 Pro / Flash を利用した高速なアプリ構築
- **複数のプロバイダー対応**: Gemini API、Vertex AI Express Mode、Vertex AI Standard (OAuth) から選択可能
- **レイアウト操作**: サイドペインの幅・iframe高さをドラッグで調整し、ページ幅を縮めるピン留めモードと全画面表示を切り替え可能
- **PDF対応**: PDFページを検知してPDFバイナリをAIに添付
- **数式レンダリング**: Geminiが生成したアプリ内で `$ $` または `$$ $$` で囲まれた数式を自動的にKaTeXでレンダリング
- **対話的な改善**: 「アニメーションを追加して」「もっとインタラクティブに」などの追加指示でアプリの改善が可能
- **バージョン管理**: 過去に生成したアプリをプルダウンで即座に切り替え
- **コスト管理機能**: 生成ごとのトークン数・料金を自動計算し、月ごとの累計消費額を表示（料金は概算）
- **サイト別カスタマイズ**: URLごとに専用プロンプトを設定可能（AtCoder等の例を標準で提供）
- **多言語対応**: 日本語・英語のUI・プロンプトに対応
- **データ・プライバシー管理**: 生成プロンプト編集に加え、設定/履歴のバックアップ・復元、履歴のみのエクスポート＆全削除、初回生成時のデータ送信同意と後からのリセットに対応

---

## 📝 使い方

### 1. セットアップ
1. 本リポジトリをクローンまたはダウンロードします。
2. Chromeで `chrome://extensions` を開き、右上の「**デベロッパーモード**」を有効にします。
3. 「**パッケージ化されていない拡張機能を読み込む**」をクリックし、ダウンロードしたフォルダ (`manifest.json` が含まれるフォルダ) を選択します。

### 2. 初期設定

本拡張機能は**3つのプロバイダー**から選択して利用できます：

#### オプション A: Gemini API（従来の方式）
1. 拡張機能アイコンを右クリック ＞「オプション」を開きます。
2. プロバイダーで「**Gemini API**」を選択します。
3. [Gemini API Key](https://ai.google.dev/gemini-api/docs/api-key?hl=ja) を取得して入力します。
4. 「保存」をクリックし、「接続テスト」で動作を確認します。

#### オプション B: Vertex AI Express Mode（90日間無料トライアル）
1. 拡張機能アイコンを右クリック ＞「オプション」を開きます。
2. プロバイダーで「**Vertex AI Express Mode**」を選択します。
3. Google Cloud APIキーを取得します：
   - [Google Cloud Console](https://console.cloud.google.com/) にアクセス
   - プロジェクトを作成（または既存のプロジェクトを選択）
   - Vertex AI APIを有効化
   - [認証情報ページ](https://console.cloud.google.com/apis/credentials) で「APIキー」を作成
4. 取得したAPIキーを入力し、モデル名（推奨: `gemini-3-pro-preview`）を設定します。
5. 「保存」をクリックし、「接続テスト」で動作を確認します。

**特徴**: 90日間の無料トライアルが利用可能で、Gemini APIと同じくAPIキーだけで簡単に使えます。

#### オプション C: Vertex AI Standard（OAuth認証・本格運用向け）
最も本格的な方式で、OAuth 2.0認証を使用します。

**事前準備**:
1. [Google Cloud Console](https://console.cloud.google.com/) でプロジェクトを作成
   - プロジェクトを作成後、**Project ID**（例: `my-project-123456`）をメモしてください
   - Project IDはプロジェクト選択ドロップダウンで確認できます（プロジェクト名の下に表示されます）
2. Vertex AI APIを有効化
   - [APIライブラリ](https://console.cloud.google.com/apis/library)で「Vertex AI API」を検索して有効化
3. OAuth 2.0 Client IDを作成：
   - [認証情報ページ](https://console.cloud.google.com/apis/credentials) を開く
   - 「認証情報を作成」→「OAuth クライアント ID」
   - 同意画面の設定を求められた場合は、User Type を「外部」で作成し、必要最小限の情報を入力
   - アプリケーションの種類: **「ウェブ アプリケーション」**を選択
   - 名前: 任意（例: "PlayPage OAuth Client"）
   - 「承認済みのリダイレクト URI」に以下を追加:
     - PlayPageの設定画面（Options）で「Vertex AI Standard」を選択すると、**承認済みのリダイレクトURI**が表示されます
     - そのURIをコピーして、ここに貼り付けます（形式: `https://<拡張機能ID>.chromiumapp.org/`）
   - 生成されたClient ID（`xxxxx.apps.googleusercontent.com` 形式）をコピー

**設定手順**:
1. 拡張機能アイコンを右クリック ＞「オプション」を開きます。
2. プロバイダーで「**Vertex AI Standard (OAuth)**」を選択します。
3. 以下の情報を入力：
   - **Google Cloud Project ID**: プロジェクトのID（例: `my-project-123456`）
     - ⚠️ プロジェクト**名**ではなく、プロジェクト**ID**を入力してください
     - Google Cloud Consoleの上部、プロジェクト選択ドロップダウンで確認できます
   - **Location (Region)**: `us-central1`（推奨）または他のリージョン
   - **OAuth 2.0 Client ID**: 上記で作成したClient ID（`xxxxx.apps.googleusercontent.com` 形式）
   - **Model**: `gemini-2.5-pro`（推奨）または `gemini-2.5-flash`
4. 「保存」をクリックします。
5. **「Googleアカウントで認証」**ボタンをクリックし、Googleアカウントで認可します。
6. 認証完了後、「接続テスト」で動作を確認します。

**注意事項**:
- アクセストークンは約1時間で期限切れになります。期限切れ時は再度「Googleアカウントで認証」をクリックしてください。
- Vertex AI Standardは Google Cloudの課金対象です。[価格表](https://cloud.google.com/vertex-ai/pricing)を確認してください。

### 3. アプリの生成・改善、及び利用
1. 任意のWebページにアクセスします。
2. 拡張機能アイコンをクリックして、サイドパネルを開きます。
3. 初回のみ、閲覧ページHTMLを送信するための同意ダイアログが表示されます。内容を確認のうえ同意してください。
4. 「生成」ボタンを押します。1分〜3分ほどでアプリが生成・埋め込みされ、操作可能になります。
5. （任意）「改善プロンプト」を入力すると、現在のアプリHTMLとdescriptionを踏まえて再生成します。

#### サイドペインの操作
- 📌: フロート表示 ⇔ ページ幅を縮める表示を切り替え
- ⛶: 生成アプリ領域だけを全画面化／元に戻す
- 左端/下端のハンドル: ペイン幅とiframe高さをドラッグで調整
- プルダウン: ページごとの生成履歴（タイムスタンプ付きタイトル）を即座に切替

### 4. プロンプトのカスタマイズ（オプション）
「オプション」画面では以下の設定が可能です:
- **一般サイト用プロンプト**: すべてのサイトで使用されるデフォルトのプロンプト
- **特定サイト用プロンプト**: 特定のURL（例: https://atcoder.jp/）に対してカスタマイズされたプロンプト
- **言語設定**: UI・プロンプトの言語（日本語/英語）
- **AIモデル**: 使用するGeminiモデルの選択

### 5. データのバックアップ・復元と履歴削除
- **全データのエクスポート/インポート**: 設定と生成履歴をまとめてJSONでバックアップ・復元
- **履歴のみエクスポート＆全削除**: 生成履歴を安全に退避してから一括削除（APIキーやモデル設定は保持）
- **同意のリセット**: オプション画面の「プライバシー」で同意状態の確認とリセットが可能

### 6. コスト管理機能
本拡張機能は、Gemini APIの利用料金を自動的に推定し、月ごとの累計消費額を表示します。

#### 機能
- **生成ごとのコスト表示**: アプリ生成時に、使用したトークン数と推定料金（ドル）を表示
- **月間累計の表示**: サイドペインの「月間利用料金」セクションに、月ごとの累計消費額を最大6ヶ月分表示
- **履歴保存**: 各生成の日時、モデル、トークン数、料金を自動的に保存

#### 料金計算について
- 料金は、[Gemini API公式ドキュメント](https://ai.google.dev/gemini-api/docs/pricing?hl=ja)および[Vertex AI料金ページ](https://cloud.google.com/vertex-ai/generative-ai/pricing?hl=ja)に基づいて計算されます。
- モデルごとに異なるレート（入力トークン・出力トークンそれぞれの単価）が適用されます。
- **注意**: この料金は**概算**です。正確な料金はGoogle Cloudコンソールで確認してください。

---

## ⚠️ 注意事項

### 利用制限とルール
- **競技プログラミングサイトでの利用**:
  AtCoderなどの競技プログラミングサイトで開催中のコンテストでの利用は、ルール違反となる可能性があります。本拡張機能はAtCoderコンテスト時間内の利用を制限していますが、利用にあたっては各サイトのLLM利用ルール（例: [AtCoderのLLM利用ルール](https://info.atcoder.jp/entry/llm-rules-ja)）を必ず遵守してください。AtCoder以外の競技プログラミングサイトにおいても、同様に生成AIの利用ルールに従ってください。
- **対応サイト**:
  HTTP/HTTPSでアクセス可能なあらゆるWebページで利用可能です。サイトごとに専用プロンプトを設定することで、より適切なビジュアライゼーションが可能です。

### API・費用について
- **APIキー・認証管理**:
  - **Gemini API**: APIキーを各自で取得・管理してください。
  - **Vertex AI Express Mode**: Google Cloud APIキーを取得（90日間無料トライアル付き）
  - **Vertex AI Standard**: OAuth認証を使用（Google Cloudアカウントが必要）
- **費用**:
  - Gemini APIの料金: [Gemini API料金](https://ai.google.dev/pricing)
  - Vertex AIの料金: [Vertex AI料金](https://cloud.google.com/vertex-ai/pricing)
  - API利用料は利用者の負担となります。
- **データ送信**: 閲覧中のページのHTML内容がAPI（Gemini API / Vertex AI）に送信されます。無料枠利用時のデータ取り扱いはGoogleの規約をご確認ください。
- **入力サイズ**: PDFは最大10MBまで添付。長大なHTMLは一部をトリミングし、その旨をプロンプトに記載して送信します。

### セキュリティ
- 生成されたコードはサンドボックス化された `iframe` 内で実行されます。またCSPによって外部のネットワークへの通信が一部制限されます。
- AI生成物のため、生成されたアプリの安全性を保証することはできません。不審な動作を感じた場合は利用を中止してください。

---

## 📄 ライセンス
[LICENSE](./LICENSE) を参照してください。
